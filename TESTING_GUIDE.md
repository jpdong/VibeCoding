# VibeCoding 支付订阅和取消订阅测试用例文档

## 概述

本文档包含VibeCoding网站完整的支付订阅和取消订阅功能测试用例。每次修改相关功能后，都应按照此文档进行完整测试。

## 测试环境要求

- 开发服务器运行在 `http://localhost:3000`
- 测试用信用卡号：`4242 4242 4242 4242`
- 其他信用卡信息可随意填写（如：过期日期 12/34，CVC 123）
- 需要有效的Google账号用于登录测试

## 完整测试流程

### 阶段1：登录状态检查和处理

#### 测试用例 1.1：检查当前登录状态
- **目标**：验证用户登录状态
- **步骤**：
  1. 访问 `http://localhost:3000`
  2. 检查页面右上角是否显示用户头像或"Log in"按钮
- **预期结果**：
  - 已登录：显示用户头像和下拉箭头
  - 未登录：显示"Log in"按钮

#### 测试用例 1.2：Google登录流程（如果未登录）
- **目标**：完成Google账号登录
- **步骤**：
  1. 点击"Log in"按钮
  2. 选择Google登录选项
  3. 完成Google账号认证
  4. 确认返回网站并显示用户头像
- **预期结果**：
  - 成功登录后页面显示用户头像
  - 头像旁有下拉箭头图标

### 阶段2：订阅支付流程测试

#### 测试用例 2.1：进入定价页面
- **目标**：访问订阅定价页面
- **步骤**：
  1. 点击导航栏中的"Price"按钮 或
  2. 访问 `http://localhost:3000/#pricing`
- **预期结果**：
  - 页面显示定价计划
  - 显示Free和Premium计划对比
  - Premium计划有"升级"或"订阅"按钮

#### 测试用例 2.2：启动订阅流程
- **目标**：开始Premium订阅流程
- **步骤**：
  1. 在Premium计划卡片中点击"Upgrade to Premium"或类似按钮
  2. 确认跳转到支付页面
- **预期结果**：
  - 跳转到Creem支付页面
  - 显示订阅金额（$9.99/month）
  - 显示支付表单

#### 测试用例 2.3：填写支付信息
- **目标**：完成支付信息填写
- **步骤**：
  1. 信用卡号码：`4242 4242 4242 4242`
  2. 过期日期：`12/34`（或任何未来日期）
  3. CVC：`123`
  4. 持卡人姓名：`Test User`
  5. 邮政编码：`12345`
  6. 点击"支付"或"Subscribe"按钮
- **预期结果**：
  - 支付处理成功
  - 跳转到成功页面或返回网站

#### 测试用例 2.4：验证支付成功
- **目标**：确认支付完成并跳转正确
- **步骤**：
  1. 观察支付完成后的页面跳转
  2. 确认返回到网站主页或成功页面
- **预期结果**：
  - 显示支付成功信息
  - 没有支付错误提示

### 阶段3：会员状态验证

#### 测试用例 3.1：检查Settings页面订阅状态
- **目标**：验证用户已成为付费会员
- **步骤**：
  1. 点击用户头像打开下拉菜单
  2. 点击"Settings"进入设置页面
  3. 检查"Subscription Management"部分
- **预期结果**：
  - Current Plan显示："Premium Plan"
  - 订阅状态显示："active"
  - 显示订阅详细信息（计费周期、订阅ID等）
  - 显示"Manage Subscription"和"Cancel Subscription"按钮

#### 测试用例 3.2：检查使用限制提升
- **目标**：验证Premium用户的使用限制
- **步骤**：
  1. 在Settings页面点击"Usage"标签
  2. 查看"Today's Usage"部分
  3. 查看"Plan Comparison"部分
- **预期结果**：
  - Daily Limit显示更高的数值（如300）
  - Plan Comparison中当前用户对应Premium计划

#### 测试用例 3.3：检查主页会员状态显示
- **目标**：验证主页正确显示会员状态
- **步骤**：
  1. 返回网站主页 `http://localhost:3000`
  2. 检查使用情况显示区域
- **预期结果**：
  - 显示Premium用户的使用限制
  - 使用量显示格式：X / 300（或相应的Premium限制）

### 阶段4：取消订阅流程测试

#### 测试用例 4.1：访问取消订阅功能
- **目标**：找到并访问取消订阅选项
- **步骤**：
  1. 进入Settings页面
  2. 确保在"Subscription"标签页
  3. 找到红色的"Cancel Subscription"按钮
- **预期结果**：
  - 显示红色的"Cancel Subscription"按钮
  - 按钮包含警告图标
  - 按钮仅对有活跃订阅的用户显示

#### 测试用例 4.2：取消订阅确认流程
- **目标**：测试取消订阅的确认机制
- **步骤**：
  1. 点击"Cancel Subscription"按钮
  2. 阅读确认对话框内容
  3. 点击"OK"确认取消
- **预期结果**：
  - 显示详细的确认对话框，包含：
    - 取消后果的说明
    - 访问期限说明
    - 重新激活选项说明
  - 提供"OK"和"Cancel"选项

#### 测试用例 4.3：验证取消订阅API调用
- **目标**：确认取消订阅请求成功处理
- **步骤**：
  1. 确认取消后观察页面反馈
  2. 检查是否显示成功消息
- **预期结果**：
  - 显示成功取消的消息
  - 消息包含访问期限说明

### 阶段5：取消后状态验证

#### 测试用例 5.1：检查取消状态显示
- **目标**：验证取消订阅后的状态显示
- **步骤**：
  1. 页面自动刷新或手动刷新Settings页面
  2. 检查订阅详情中的"Cancel at Period End"字段
  3. 检查按钮状态变化
- **预期结果**：
  - "Cancel at Period End"显示为"Yes"并有橙色警告图标
  - 显示订阅结束日期
  - "Cancel Subscription"按钮消失
  - 显示橙色状态条"Cancelling at period end"

#### 测试用例 5.2：验证访问权限维持
- **目标**：确认取消后仍保持Premium访问直到周期结束
- **步骤**：
  1. 检查Current Plan是否仍显示"Premium Plan"
  2. 检查使用限制是否维持Premium水平
  3. 返回主页测试功能访问
- **预期结果**：
  - Current Plan仍显示"Premium Plan"
  - 使用限制保持Premium水平
  - 所有Premium功能正常访问

## 测试数据

### 测试用信用卡信息
```
卡号：4242 4242 4242 4242
过期日期：12/34
CVC：123
姓名：Test User
邮政编码：12345
```

### 预期订阅信息
```
计划：Premium Plan
价格：$9.99/month
使用限制：300 generations/day
功能：所有Premium功能
```

## 常见问题和故障排除

### 支付失败
- 检查测试卡号是否正确输入
- 确认网络连接正常
- 检查Creem支付服务状态

### 登录问题
- 确认Google登录服务正常
- 检查浏览器是否阻止弹窗
- 清除浏览器缓存和Cookie

### 状态更新延迟
- 手动刷新页面
- 检查API响应时间
- 确认数据库连接正常

## 自动化测试脚本

可以使用Playwright编写自动化测试脚本，覆盖以上所有测试用例。脚本应包括：
1. 登录状态检查和处理
2. 订阅支付流程自动化
3. 状态验证断言
4. 取消订阅流程自动化
5. 最终状态验证

## 测试频率建议

- **每次发布前**：完整测试流程
- **支付相关功能修改后**：重点测试阶段2-3
- **订阅管理功能修改后**：重点测试阶段4-5
- **UI/UX修改后**：验证用户体验流程

---

**注意**：此文档应随功能更新而更新，确保测试用例与实际功能保持一致。